# Session Workflow - Compact Reference
# For examples and workflow details, see: session-workflow.md

MANDATORY-REREAD: before-whats-next-queries (use-3-step-process)

## Session = Long-term Memory
purpose: persist state across conversation resets (context window cleanup)
mapping: 1 session = 1 issue = 1 branch = 1 branch-metadata-file

## Auto-Detection
on-startup: git branch → .claude/branches/<sanitized> → load session file
user-asks: "What's next?" or "What are we working on?"
manual: "Read .claude/sessions/<file>.md"

## CRITICAL: Determining "What's Next"
ALWAYS run these commands in order (single message, parallel tool calls):
1. git branch --show-current (get authoritative current branch)
2. .claude/tools/get-current-session.sh (verify session mapping)
3. Read .claude/sessions/<session-file>.md (find "Next Steps" section)
NEVER guess or assume current branch - ALWAYS check first

## Session Files
location: .claude/sessions/
format: <IssueNum>-<desc>.md OR chore-<desc>.md
content: goal, done, todo, context, files-changed, next-steps
creation:
  manual: .claude/tools/create-branch-metadata.sh
  auto: work-item automation (GitHub/Jira/Azure DevOps)
update: beginning-work, after-milestone, before-pause, when-blocked, before-commit
commit: atomic (session+code in same commit)

## Branch Metadata
location: .claude/branches/
format: <branch-name-sanitized> (/ → -)
content: session:<file>, status:<state>, todo:<list>
size: 3-5 lines (ultra-compact)

## Workflow

### Manual Creation
start: create branch → .claude/tools/create-branch-metadata.sh → creates metadata + session
work: implement → update session after each major task
pause: update session, mark status
resume: switch branch → auto-loads correct session
complete: mark session complete, merge PR

### Auto-Population (Work-Item Automation)
start: create branch from issue (issue/feature-N/desc OR feature/PROJ-123/desc)
detect: parse branch → extract issue identifier → detect platform (GitHub/Jira/Azure DevOps)
fetch: call API (gh/jira/az) → retrieve issue details
populate: map issue to session (title→goal, body→objectives, labels→tags)
sync: bidirectional (session updates → issue comments, issue changes → session alerts)

## Key Patterns
fresh-conversation-not-equal-lost-context: session file persists state
reset-context-window: start new conversation, read session, quality restored
branch-switch-equal-session-switch: automatic via metadata
commit-regularly: session updates are code documentation

## Tools
get: .claude/tools/get-current-session.sh
create-manual: .claude/tools/create-branch-metadata.sh
create-auto: work-item detection skill (auto-populates from GitHub/Jira/Azure DevOps)
sync: bidirectional sync (session ↔ issue)

## Benefits
resumable: pick up exactly where left off
traceable: maps to github issues, jira tickets, azure devops work items
handoff: teammates read session, understand work
memory: external state outside context window
automated: zero manual session creation for issue-based work
synced: session stays in sync with work item (bidirectional)
