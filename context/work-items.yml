# Work-Item Automation Workflow

## Purpose
Automate GitHub/Jira/Azure DevOps work-item maintenance. Zero manual session creation for issue-based work.

## Supported Platforms
platforms:
  github:
    pattern: "issue/feature-N/desc"
    identifier: "#29"
    api: gh
    priority: 1  # implement first

  jira:
    pattern: "feature/PROJ-123/desc"
    identifier: "PROJ-123"
    api: imdone_cli  # leverage imdone.io for Jira (markdown-based, bidirectional sync)
    priority: 2  # implement second
    tool: https://imdone.io/ (manages Jira as markdown, git-like CLI)

  azure_devops:
    pattern: "feature/456/desc"
    identifier: "#456"
    api: az_boards
    priority: 3  # implement third

## Auto-Detection
detection:
  trigger: session_start, branch_switch, manual_request
  method: parse_branch_name
  format_detection:
    - "PROJ-123" → Jira (PROJECT-N pattern)
    - "#29" → GitHub (hash prefix)
    - "29" → GitHub or Azure DevOps (numeric, disambiguate via API)
  validation: check_issue_exists_via_api
  caching: yes  # avoid repeated API calls

## Auto-Population Workflow
workflow:
  1_detect: parse branch → extract identifier → detect platform
  2_fetch: call appropriate API (gh/jira/az) → get issue details
  3_map: map issue fields to session structure
  4_populate: generate session file from template
  5_metadata: update branch metadata with session link

mapping:
  github:
    title: issue.title
    body: issue.body → objectives/requirements
    labels: issue.labels → session.tags
    milestone: issue.milestone
    assignee: issue.assignee
    url: issue.html_url

  jira:
    method: imdone CLI (markdown-based)
    pull: imdone pull PROJ-123 → generates markdown file
    map: imdone markdown → session structure
    fields:
      title: from markdown header
      body: from markdown content → objectives/requirements
      metadata: from frontmatter (type, status, priority, assignee)
      custom: story points, sprint, epic from frontmatter
    push: session updates → imdone push → syncs to Jira

  azure_devops:
    title: workItem.fields["System.Title"]
    body: workItem.fields["System.Description"] → objectives
    type: workItem.fields["System.WorkItemType"]
    state: workItem.fields["System.State"]
    assigned: workItem.fields["System.AssignedTo"]

## Bidirectional Sync
sync:
  session_to_issue:
    trigger: session_update, milestone_complete
    action: post_comment_on_issue
    content: session_log_entry, decisions, learnings

  issue_to_session:
    trigger: status_change, label_change, comment_added
    action: alert_in_session_or_auto_update
    examples:
      - issue closed → mark session complete
      - label added → update session tags
      - priority changed → update session notes

  conflict_resolution:
    strategy: last_write_wins_with_alert
    alert: both changed simultaneously

## Configuration
config:
  location: .claude/config.json
  fields:
    workItems:
      platform: github | jira | azure_devops  # explicit or auto-detect
      autoPopulate: true  # auto-create session from issue
      syncEnabled: true  # bidirectional sync
      syncInterval: 300  # seconds between sync checks

      github:
        repo: owner/repo  # optional, auto-detect from git remote

      jira:
        method: imdone  # use imdone.io CLI for Jira integration
        host: https://company.atlassian.net
        project: PROJ  # project key
        imdone:
          install: npm i -g imdone-cli
          auth: imdone login  # authenticate with Jira
          pull: imdone pull <issue-key>  # fetch as markdown
          push: imdone push  # sync changes to Jira
        customFields:  # imdone handles these via frontmatter
          story_points: customfield_10016
          epic_link: customfield_10014

      azure_devops:
        organization: myorg
        project: MyProject

## Examples

### Example 1: GitHub Auto-Population
branch: issue/feature-29/work-item-automation
action: session start
result:
  detected: GitHub issue #29
  fetched: title, body, labels from API
  created: .claude/sessions/29-work-item-automation.md
  populated: objectives from issue body, metadata from labels

### Example 2: Jira Auto-Population
branch: feature/PROJ-123/implement-auth
action: session start
result:
  detected: Jira issue PROJ-123
  fetched: summary, description, story points from API
  created: .claude/sessions/PROJ-123-implement-auth.md
  populated: objectives from description, story points in metadata

### Example 3: Bidirectional Sync
scenario: session updated with completion notes
action: commit triggers sync
result:
  comment posted on GitHub issue #29
  content: "Session updated: Completed Phase 1..."
  issue remains open (not auto-closed)

scenario: issue closed externally
action: sync detects closed status
result:
  session file updated with completion status
  alert: "Issue #29 was closed externally"

## Error Handling
errors:
  no_issue_in_branch:
    action: skip_auto_population
    message: "No issue detected in branch name"

  issue_not_found:
    action: fail_with_error
    message: "Issue #29 not found via API"
    suggestion: "Check issue number and API access"

  api_auth_failed:
    action: fail_with_error
    message: "API authentication failed"
    suggestion: "Run 'gh auth login' or configure Jira credentials"

  api_rate_limit:
    action: use_cached_data_or_fail
    message: "API rate limit exceeded"
    suggestion: "Wait or use cached issue data"

## Benefits
benefits:
  - Zero manual session creation for issue-based work
  - Session always in sync with issue details
  - Automatic updates to issue from session progress
  - Works across GitHub, Jira, Azure DevOps
  - No context switching between tools

## Elaboration
See: context/work-item-workflow.md for detailed workflow examples and configuration
