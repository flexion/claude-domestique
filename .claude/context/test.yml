# Claude Domestique - Testing Context
# Extends: mantra/context/test.yml (base testing conventions)

## FRAMEWORKS
all-plugins: jest

## RUN TESTS
mantra: cd mantra && npm test
memento: cd memento && npm test
onus: cd onus && npm test
all: run each plugin separately (no root npm test)

## TARGETED TESTS
single-file: npm test -- path/to/file.test.js
pattern: npm test -- -t "test name pattern"
watch: npm test -- --watch

## COVERAGE
generate: npm test -- --coverage
output: coverage/ (gitignored)

## TEST LOCATIONS
hooks: <plugin>/hooks/__tests__/*.test.js
scripts: <plugin>/scripts/__tests__/*.test.js
pattern: __tests__ folder adjacent to source

## DI PATTERNS (project-specific)
state-path: inject via options object (statePath param)
filesystem: inject fs module or use temp dirs
git: real git in temp directories (not mocked)
child_process: inject execSync for testability

## HOOK TESTING
input: JSON object (hook_event_name, cwd, tool_input)
output: { decision, reason } or { systemMessage }
pattern: call exported functions directly (not CLI)

## TEMP DIRECTORIES
create: fs.mkdtempSync(path.join(os.tmpdir(), 'plugin-test-'))
cleanup: fs.rmSync(tempDir, { recursive: true, force: true })
git-setup: git init + config + initial commit

## WATCH MODE
command: npm test -- --watch
